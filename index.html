<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>SECM - Application Débit</title>
  <style>
    body{font-family:Arial;margin:0;background:#0f1216;color:#fff}
    header{display:flex;align-items:center;gap:12px;padding:14px 16px;background:#11151b;position:sticky;top:0;z-index:10}
    header h1{font-size:18px;margin:0}
    .wrap{max-width:980px;margin:0 auto;padding:16px}
    h2{margin:6px 0 12px}
    .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
    .card{background:#151a21;border-radius:14px;padding:10px;cursor:pointer;border:1px solid #222a35}
    .card img{width:100%;height:160px;object-fit:contain;background:#0f1216;border-radius:10px}
    .card .ref{margin-top:8px;text-align:center;font-weight:700}
    .panel{margin-top:14px;background:#151a21;border:1px solid #222a35;border-radius:14px;padding:14px;display:none}
    .row{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
    .row2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    input{width:100%;padding:10px;border-radius:10px;border:1px solid #2b3442;background:#0f1216;color:#fff}
    button{padding:12px 14px;border-radius:12px;border:none;background:#ffd400;color:#111;font-weight:800;cursor:pointer;margin-top:12px}
    .selected{display:flex;align-items:center;gap:12px;margin-bottom:12px}
    .selected img{width:90px;height:70px;object-fit:contain;background:#0f1216;border-radius:10px}
    .hint{color:#cfd6e4;font-size:13px}
    .err{margin-top:10px;color:#ffb3b3;font-size:13px;white-space:pre-line}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{border-bottom:1px solid #222a35;padding:10px;text-align:left;font-size:14px}
    th{color:#cfd6e4;font-size:13px;font-weight:700}
    .pill{display:inline-block;padding:4px 10px;border-radius:999px;background:#0f1216;border:1px solid #222a35;font-size:12px;color:#cfd6e4}
    @media (min-width: 720px){ .grid{grid-template-columns:repeat(4,minmax(0,1fr));} }
  </style>
</head>
<body>
  <header><h1>Application Débit SECM</h1></header>

  <div class="wrap">
    <h2>Sélection du modèle</h2>
    <div class="hint">Clique sur un modèle → saisis les dimensions → calcul M10 complet.</div>

    <div id="grid" class="grid"></div>

    <div id="panel" class="panel">
      <div class="selected">
        <img id="selImg" src="" alt="">
        <div>
          <div style="font-weight:800;font-size:16px;">Modèle : <span id="selRef"></span></div>
          <div class="hint">Calculs : M10 (depuis ton Excel) + règles patins <700</div>
        </div>
      </div>

      <div class="pill">Dimensions intérieures (mm)</div>
      <div class="row" style="margin-top:10px;">
        <div><input id="L" type="number" inputmode="numeric" placeholder="Longueur L (mm)"></div>
        <div><input id="W" type="number" inputmode="numeric" placeholder="Largeur W (mm)"></div>
        <div><input id="H" type="number" inputmode="numeric" placeholder="Hauteur H (mm)"></div>
      </div>

      <div class="pill" style="margin-top:14px;">Épaisseurs plaques (mm)</div>
      <div class="row" style="margin-top:10px;">
        <div><input id="eP" type="number" inputmode="numeric" value="15" placeholder="Panneaux (15)"></div>
        <div><input id="eFond" type="number" inputmode="numeric" value="15" placeholder="Fond (15)"></div>
        <div><input id="eCouv" type="number" inputmode="numeric" value="15" placeholder="Couvercle (15)"></div>
      </div>

      <div class="pill" style="margin-top:14px;">Traverses (mm) — M10 = 100 x 18</div>
      <div class="row2" style="margin-top:10px;">
        <div><input id="tLargeur" type="number" inputmode="numeric" value="100" placeholder="Largeur traverse (100)"></div>
        <div><input id="tEp" type="number" inputmode="numeric" value="18" placeholder="Épaisseur traverse (18)"></div>
      </div>

      <div class="pill" style="margin-top:14px;">Patins (section au choix)</div>
      <div class="row2" style="margin-top:10px;">
        <div><input id="pA" type="number" inputmode="numeric" value="95" placeholder="Section A (95)"></div>
        <div><input id="pB" type="number" inputmode="numeric" value="95" placeholder="Section B (95)"></div>
      </div>

      <button onclick="calculer()">Calculer M10</button>

      <div id="err" class="err"></div>
      <div id="out"></div>
    </div>
  </div>

  <script>
    const MODELES = [
      {ref:"M10",   img:"M10.jpg"},
      {ref:"M20",   img:"M20.jpg"},
      {ref:"M30",   img:"M30.jpg"},
      {ref:"M40",   img:"M40.jpg"},
      {ref:"M50",   img:"M50.jpg"},
      {ref:"M60",   img:"M60.jpg"},
      {ref:"M70",   img:"M70.jpg"},
      {ref:"M80-B", img:"M80-B.jpg"},
    ];

    const grid = document.getElementById("grid");
    const panel = document.getElementById("panel");
    const selRef = document.getElementById("selRef");
    const selImg = document.getElementById("selImg");
    const errBox = document.getElementById("err");
    const outBox = document.getElementById("out");

    function clearMsg(){ errBox.textContent=""; outBox.innerHTML=""; }
    function showError(msg){ errBox.textContent = msg; }
    function n(id){ return Number(document.getElementById(id).value || 0); }
    function dim(a,b,c){ return `${Math.round(a)} x ${Math.round(b)} x ${Math.round(c)} mm`; }

    MODELES.forEach(m => {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `<img src="${m.img}" alt="${m.ref}"><div class="ref">${m.ref}</div>`;
      card.onclick = () => {
        clearMsg();
        selRef.textContent = m.ref;
        selImg.src = m.img;
        panel.style.display = "block";
        window.scrollTo({top: document.body.scrollHeight, behavior:"smooth"});
      };
      grid.appendChild(card);
    });

    function table(title, rows){
      return `
        <h3 style="margin:14px 0 6px;">${title}</h3>
        <table>
          <thead><tr><th>Pièce</th><th>Qté</th><th>Dimensions (L x l x e)</th></tr></thead>
          <tbody>
            ${rows.map(r=>`<tr><td>${r.nom}</td><td>${r.qte}</td><td>${r.dim}</td></tr>`).join("")}
          </tbody>
        </table>
      `;
    }

    function calculer(){
      clearMsg();

      const ref = selRef.textContent || "—";
      const L = n("L"), W = n("W"), H = n("H");
      if(!L || !W || !H){ showError("Merci de remplir Longueur (L), Largeur (W), Hauteur (H)."); return; }

      const eP = n("eP") || 15;        // panneaux faces/cotes
      const eFond = n("eFond") || 15;  // fond
      const eCouv = n("eCouv") || 15;  // couvercle
      const tLargeur = n("tLargeur") || 100;
      const tEp = n("tEp") || 18;

      const pA = n("pA") || 95;
      const pB = n("pB") || 95;

      // --- M10 (formules Excel) ---
      // Faces (x2)
      const faces_L = L + (eP*2) + (tEp*2);
      const faces_H = H + eFond;
      const faces = {nom:"FACES", qte:2, dim: dim(faces_L, faces_H, eP)};

      // Côtes (x2)
      const cotes = {nom:"CÔTÉS", qte:2, dim: dim(W, H, eP)};

      // Fond (x1) — dans ton Excel l'ajout latéral est à 0 → fond = L x W
      const fond = {nom:"FOND", qte:1, dim: dim(L, W, eFond)};

      // Couvercle (x1)
      const couv_L = L + (eP*2) - 3;
      const couv_W = W + (eP*2);
      const couv = {nom:"COUVERCLE", qte:1, dim: dim(couv_L, couv_W, eCouv)};

      // Patins — Excel : longueur = W + 2*eP ; qté = 3 si L>=1200 sinon 2
      const patin_L = W + (eP*2);

      let patinsRows = [];
      if (L < 700){
        // ta règle validée
        patinsRows.push({nom:"PATIN extérieur", qte:2, dim: dim(patin_L, 95, 45)});
        patinsRows.push({nom:"PATIN central", qte:1, dim: dim(patin_L, 95, 95)});
      } else {
        const qtePatins = (L >= 1200) ? 3 : 2;
        patinsRows.push({nom:"PATINS", qte:qtePatins, dim: dim(patin_L, pA, pB)});
      }

      // Traverses (section = tLargeur x tEp)
      const travFaces = {nom:"TRAVERSES FACES", qte:2, dim: dim(faces_L, tLargeur, tEp)};
      const travCotes = {nom:"TRAVERSES CÔTÉS", qte:4, dim: dim(H + eP + eFond, tLargeur, tEp)};
      const travCouv  = {nom:"TRAVERSES COUVERCLE", qte:2, dim: dim(patin_L, tLargeur, tEp)};

      const resume = `
        <div class="hint" style="margin-top:10px;">
          <b>Modèle</b> : ${ref} — <b>Dimensions int.</b> : ${L} x ${W} x ${H} mm<br>
          <b>Ép.</b> : panneaux ${eP} | fond ${eFond} | couvercle ${eCouv} (mm) — <b>traverses</b> ${tLargeur} x ${tEp}
        </div>
      `;

      const panneaux = [faces, cotes, fond, couv];
      const traverses = [travFaces, travCotes, travCouv];

      outBox.innerHTML =
        resume +
        table("Panneaux", panneaux) +
        table("Patins", patinsRows) +
        table("Traverses", traverses);
    }
  </script>
</body>
</html>
