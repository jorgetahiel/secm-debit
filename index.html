<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>SECM - Application Débit</title>

  <!-- PDF libs -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>

  <style>
    body{font-family:Arial;margin:0;background:#0f1216;color:#fff}
    .topbar{display:flex;align-items:center;gap:12px;padding:14px 16px;background:#11151b;position:sticky;top:0;z-index:10}
    .topbar h1{font-size:18px;margin:0}
    .logo{height:38px;width:auto}
    .wrap{max-width:980px;margin:0 auto;padding:16px}
    h2{margin:6px 0 12px}
    .hint{color:#cfd6e4;font-size:13px}

    .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
    .card{background:#151a21;border-radius:14px;padding:10px;cursor:pointer;border:1px solid #222a35}
    .card img{width:100%;height:160px;object-fit:contain;background:#0f1216;border-radius:10px}
    .card .ref{margin-top:8px;text-align:center;font-weight:700}

    .panel{margin-top:14px;background:#151a21;border:1px solid #222a35;border-radius:14px;padding:14px;display:none}
    .selected{display:flex;align-items:center;gap:12px;margin-bottom:12px}
    .selected img{width:90px;height:70px;object-fit:contain;background:#0f1216;border-radius:10px}

    .pill{display:inline-block;padding:4px 10px;border-radius:999px;background:#0f1216;border:1px solid #222a35;font-size:12px;color:#cfd6e4}
    .row{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
    .row2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    input{width:100%;padding:10px;border-radius:10px;border:1px solid #2b3442;background:#0f1216;color:#fff}

    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    button{padding:12px 14px;border-radius:12px;border:none;background:#ffd400;color:#111;font-weight:800;cursor:pointer}
    .btn2{background:#e6e9ef;color:#111}

    .err{margin-top:10px;color:#ffb3b3;font-size:13px;white-space:pre-line}

    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{border-bottom:1px solid #222a35;padding:10px;text-align:left;font-size:14px}
    th{color:#cfd6e4;font-size:13px;font-weight:700}

    @media (min-width: 720px){ .grid{grid-template-columns:repeat(4,minmax(0,1fr));} }
  </style>
</head>

<body>
  <header class="topbar">
    <img src="secm_logo.png" class="logo" alt="SECM Logo" onerror="this.style.display='none'">
    <h1>Application Débit SECM</h1>
  </header>

  <div class="wrap">
    <h2>Sélection du modèle</h2>
    <div class="hint">Choisis un modèle → saisis L/W/H → Calculer → Générer PDF (A4 portrait).</div>

    <div id="grid" class="grid"></div>

    <div id="panel" class="panel">
      <div class="selected">
        <img id="selImg" src="" alt="">
        <div>
          <div style="font-weight:800;font-size:16px;">Modèle : <span id="selRef"></span></div>
          <div class="hint">Calculs alignés sur tes Excel (lignes 21→28 + QTE colonne J).</div>
        </div>
      </div>

      <div class="pill">Dimensions intérieures (mm)</div>
      <div class="row" style="margin-top:10px;">
        <div><input id="L" type="number" inputmode="numeric" placeholder="Longueur L (mm)"></div>
        <div><input id="W" type="number" inputmode="numeric" placeholder="Largeur W (mm)"></div>
        <div><input id="H" type="number" inputmode="numeric" placeholder="Hauteur H (mm)"></div>
      </div>

      <div class="pill" style="margin-top:14px;">Paramètres (par défaut = Excel)</div>
      <div class="row" style="margin-top:10px;">
        <div><input id="eP" type="number" inputmode="numeric" value="15" placeholder="Ép panneaux (F13)"></div>
        <div><input id="eFond" type="number" inputmode="numeric" value="15" placeholder="Ép fond (F14)"></div>
        <div><input id="eCouv" type="number" inputmode="numeric" value="15" placeholder="Ép couvercle (F15)"></div>
      </div>

      <div class="row2" style="margin-top:10px;">
        <div><input id="tEp" type="number" inputmode="numeric" value="18" placeholder="Ép ceinture/traverse (F16/F17)"></div>
        <div><input id="tLarg" type="number" inputmode="numeric" value="100" placeholder="Largeur ceinture/traverse (H16/H17)"></div>
      </div>

      <div class="pill" style="margin-top:14px;">Patins (section)</div>
      <div class="row2" style="margin-top:10px;">
        <div><input id="pA" type="number" inputmode="numeric" value="95" placeholder="Patin A (F18)"></div>
        <div><input id="pB" type="number" inputmode="numeric" value="95" placeholder="Patin B (H18)"></div>
      </div>

      <div class="actions">
        <button onclick="calculer()">Calculer</button>
        <button class="btn2" onclick="genererPDF()">Générer PDF (A4)</button>
      </div>

      <div id="err" class="err"></div>
      <div id="out"></div>
    </div>
  </div>

  <script>
    // ====== MODELES (images à la racine) ======
    const MODELES = [
      {ref:"M10", img:"M10.jpg"},
      {ref:"M20", img:"M20.jpg"},
      {ref:"M30", img:"M30.jpg"},
      {ref:"M40", img:"M40.jpg"},
      {ref:"M50", img:"M50.jpg"},
      {ref:"M60", img:"M60.jpg"},
      {ref:"M70", img:"M70.jpg"},
      {ref:"M80-B", img:"M80-B.jpg"},
    ];

    const grid = document.getElementById("grid");
    const panel = document.getElementById("panel");
    const selRef = document.getElementById("selRef");
    const selImg = document.getElementById("selImg");
    const errBox = document.getElementById("err");
    const outBox = document.getElementById("out");

    let lastResult = null; // {ref,L,W,H, rows:[{nom,qte,dim}], panneaux, patins, renforts}

    function clearMsg(){ errBox.textContent=""; outBox.innerHTML=""; }
    function showError(msg){ errBox.textContent = msg; }
    function n(id){ return Number(document.getElementById(id).value || 0); }
    function round(x){ return Math.round(Number(x)); }
    function dim(a,b,c){ return `${round(a)} x ${round(b)} x ${round(c)} mm`; }

    function tableHTML(title, rows){
      return `
        <h3 style="margin:14px 0 6px;">${title}</h3>
        <table>
          <thead><tr><th>Pièce</th><th>Qté</th><th>Dimensions (L x l x e)</th></tr></thead>
          <tbody>
            ${rows.map(r=>`<tr><td>${r.nom}</td><td>${r.qte}</td><td>${r.dim}</td></tr>`).join("")}
          </tbody>
        </table>
      `;
    }

    // ====== Règle patins validée (prioritaire) ======
    function patinsRegle(L, patinLen, qteExcel, pA, pB){
      if (L < 700){
        return [
          {nom:"PATIN extérieur", qte:2, dim: dim(patinLen, 95, 45)},
          {nom:"PATIN central",  qte:1, dim: dim(patinLen, 95, 95)}
        ];
      }
      // Excel: =IF(D9>=1200,3,2)
      const qte = (typeof qteExcel === "number") ? qteExcel : ((L >= 1200) ? 3 : 2);
      return [{nom:"PATINS", qte:qte, dim: dim(patinLen, pA, pB)}];
    }

    // ====== CALCULS (copie exacte des formules vues dans les Excel) ======

    // M10.xlsx (TRAVERSES)
    // 21 FACES:   D = L + 2*eP + 2*tEp ; F = H + eFond ; H = eP ; QTE=2
    // 22 COTES:   D = W ; F = H ; H = eP ; QTE=2
    // 23 FOND:    D = W + 2*eP ; F = W ; H = eFond ; QTE=1
    // 24 COUVERCLE: D = L + 2*eP - 2 ; F = W + 2*eP ; H = eCouv ; QTE=1
    // 25 PATINS:  D = W + 2*eP ; F=pA ; H=pB ; QTE=IF(L>=1200,3,2)
    // 26 TRAV FACES: D = D21 ; F=tLarg ; H=tEp ; QTE=2
    // 27 TRAV COTES: D = H + eP + eFond ; F=tLarg ; H=tEp ; QTE=4
    // 28 TRAV COUVERCLE: D = F24 ; F=tLarg ; H=tEp ; QTE=2
    function calcM10(L,W,H,eP,eFond,eCouv,tEp,tLarg,pA,pB){
      const faces_L = L + eP*2 + tEp*2;
      const faces_H = H + eFond;

      const panneaux = [
        {nom:"FACES", qte:2, dim: dim(faces_L, faces_H, eP)},
        {nom:"COTES", qte:2, dim: dim(W, H, eP)},
        {nom:"FOND", qte:1, dim: dim(W + eP*2, W, eFond)},
        {nom:"COUVERCLE", qte:1, dim: dim(L + eP*2 - 2, W + eP*2, eCouv)},
      ];

      const patinLen = W + eP*2;
      const patins = patinsRegle(L, patinLen, null, pA, pB);

      const renforts = [
        {nom:"TRAVERSES FACES", qte:2, dim: dim(faces_L, tLarg, tEp)},
        {nom:"TRAVERSES COTES", qte:4, dim: dim(H + eP + eFond, tLarg, tEp)},
        {nom:"TRAVERSES COUVERCLE", qte:2, dim: dim(W + eP*2, tLarg, tEp)},
      ];

      return {panneaux, patins, renforts, renfortsTitre:"Traverses"};
    }

    // M20.xlsx (CEINTURES)
    // 22 COTES: D=W ; F=H+eFond+pB-5 ; H=eP ; QTE=2
    // 27 CEINTURES COTES: D = F22 + eCouv
    function calcM20(L,W,H,eP,eFond,eCouv,tEp,tLarg,pA,pB){
      const faces_L = L + eP*2 + tEp*2;
      const faces_H = H + eFond;

      const cotes_L = W;
      const cotes_H = H + eFond + pB - 5;

      const panneaux = [
        {nom:"FACES", qte:2, dim: dim(faces_L, faces_H, eP)},
        {nom:"COTES", qte:2, dim: dim(cotes_L, cotes_H, eP)},
        {nom:"FOND", qte:1, dim: dim(L, W, eFond)},
        {nom:"COUVERCLE", qte:1, dim: dim(L + eP*2 - 2, W + eP*2, eCouv)},
      ];

      const patinLen = W + eP*2;
      const patins = patinsRegle(L, patinLen, null, pA, pB);

      const renforts = [
        {nom:"CEINTURES FACES", qte:2, dim: dim(faces_L, tLarg, tEp)},
        {nom:"CEINTURES COTES", qte:4, dim: dim(cotes_H + eCouv, tLarg, tEp)},
        {nom:"CEINTURES COUVERCLE", qte:2, dim: dim(W + eP*2, tLarg, tEp)},
      ];

      return {panneaux, patins, renforts, renfortsTitre:"Ceintures"};
    }

    // M30.xlsx (CEINTURES)
    // 21 FACES: D=L+2eP ; F=H+eFond ; H=eP
    // 22 COTES: D=W ; F=H+eFond+pB-5 ; H=eP
    // 24 COUVERCLE: D=L+2eP-2 ; F=W+2eP-2
    // 26 CEINTURE FACES: D = F21 + (pB-5) + eCouv
    // 27 CEINTURE COTES: D = F22 + 15
    // 28 CEINTURE COUVERCLE: D = F24
    function calcM30(L,W,H,eP,eFond,eCouv,tEp,tLarg,pA,pB){
      const faces_L = L + eP*2;
      const faces_H = H + eFond;

      const cotes_L = W;
      const cotes_H = H + eFond + pB - 5;

      const panneaux = [
        {nom:"FACES", qte:2, dim: dim(faces_L, faces_H, eP)},
        {nom:"COTES", qte:2, dim: dim(cotes_L, cotes_H, eP)},
        {nom:"FOND", qte:1, dim: dim(L, W, eFond)},
        {nom:"COUVERCLE", qte:1, dim: dim(L + eP*2 - 2, W + eP*2 - 2, eCouv)},
      ];

      const patinLen = W + eP*2;
      const patins = patinsRegle(L, patinLen, null, pA, pB);

      const renforts = [
        {nom:"CEINTURE FACES", qte:4, dim: dim(faces_H + (pB - 5) + eCouv, tLarg, tEp)},
        {nom:"CEINTURE COTES", qte:4, dim: dim(cotes_H + 15, tLarg, tEp)},
        {nom:"CEINTURE COUVERCLE", qte:2, dim: dim(W + eP*2 - 2, tLarg, tEp)},
      ];

      return {panneaux, patins, renforts, renfortsTitre:"Ceintures"};
    }

    // M40.xlsx (CEINTURES)
    // 22 COTES: D=W+eFond+(pB-5) ; F=H+eFond+pB-5
    // 26 CEINTURE FACES: D = H + eCouv + eFond + pB - 5
    // 27 CEINTURE COTES: D = H + eFond + eCouv + pB - 5
    function calcM40(L,W,H,eP,eFond,eCouv,tEp,tLarg,pA,pB){
      const faces_L = L + eP*2;
      const faces_H = H + eFond;

      const cotes_L = W + eFond + (pB - 5);
      const cotes_H = H + eFond + pB - 5;

      const panneaux = [
        {nom:"FACES", qte:2, dim: dim(faces_L, faces_H, eP)},
        {nom:"COTES", qte:2, dim: dim(cotes_L, cotes_H, eP)},
        {nom:"FOND", qte:1, dim: dim(L, W, eFond)},
        {nom:"COUVERCLE", qte:1, dim: dim(L + eP*2 - 2, W + eP*2 - 2, eCouv)},
      ];

      const patinLen = W + eP*2;
      const patins = patinsRegle(L, patinLen, null, pA, pB);

      const renforts = [
        {nom:"CEINTURE FACES", qte:4, dim: dim(H + eCouv + eFond + pB - 5, tLarg, tEp)},
        {nom:"CEINTURE COTES", qte:4, dim: dim(H + eFond + eCouv + pB - 5, tLarg, tEp)},
        {nom:"CEINTURE COUVERCLE", qte:2, dim: dim(W + eP*2 - 2, tLarg, tEp)},
      ];

      return {panneaux, patins, renforts, renfortsTitre:"Ceintures"};
    }

    // M50.xlsx (CEINTURES)
    // 26 CEINTURE FACES: D = L + 2eP + 2tEp
    // 27 CEINTURE COTES: D = W + 2eP
    function calcM50(L,W,H,eP,eFond,eCouv,tEp,tLarg,pA,pB){
      const faces_L = L + eP*2;
      const faces_H = H + eFond;

      const cotes_L = W;
      const cotes_H = H + eFond + pB - 5;

      const panneaux = [
        {nom:"FACES", qte:2, dim: dim(faces_L, faces_H, eP)},
        {nom:"COTES", qte:2, dim: dim(cotes_L, cotes_H, eP)},
        {nom:"FOND", qte:1, dim: dim(L, W, eFond)},
        {nom:"COUVERCLE", qte:1, dim: dim(L + eP*2 - 2, W + eP*2, eCouv)},
      ];

      const patinLen = W + eP*2;
      const patins = patinsRegle(L, patinLen, null, pA, pB);

      const renforts = [
        {nom:"CEINTURE FACES", qte:4, dim: dim(L + eP*2 + tEp*2, tLarg, tEp)},
        {nom:"CEINTURE COTES", qte:4, dim: dim(W + eP*2, tLarg, tEp)},
        {nom:"CEINTURE COUVERCLE", qte:2, dim: dim(W + eP*2, tLarg, tEp)},
      ];

      return {panneaux, patins, renforts, renfortsTitre:"Ceintures"};
    }

    // M60.xlsx (CEINTURES) — patins section par défaut 70x18 dans ton Excel
    // 21 FACES: D=L+2eP ; F=H
    // 23 FOND:  (L+2eP) x (W+2eP)
    // 26 CEINTURE FACES: D = pA + tEp ; F = H + eCouv + eFond + pB ; H = tEp
    // 27 CEINTURE COTES: D = pA ; F = F26 ; H = tEp
    // 28 CEINTURE COUVERCLE: D = W + 2eP ; F = pA ; H = tEp
    function calcM60(L,W,H,eP,eFond,eCouv,tEp,tLarg,pA,pB){
      const faces_L = L + eP*2;
      const faces_H = H;

      const fond_L = L + eP*2;
      const fond_W = W + eP*2;

      const panneaux = [
        {nom:"FACES", qte:2, dim: dim(faces_L, faces_H, eP)},
        {nom:"COTES", qte:2, dim: dim(W, H, eP)},
        {nom:"FOND", qte:1, dim: dim(fond_L, fond_W, eFond)},
        {nom:"COUVERCLE", qte:1, dim: dim(L + eP*2 - 2, W + eP*2 - 2, eCouv)},
      ];

      const patinLen = W + eP*2;
      const patins = patinsRegle(L, patinLen, null, pA, pB);

      const ceintH = H + eCouv + eFond + pB;

      const renforts = [
        {nom:"CEINTURE FACES", qte:4, dim: dim(pA + tEp, ceintH, tEp)},
        {nom:"CEINTURE COTES", qte:4, dim: dim(pA, ceintH, tEp)},
        {nom:"CEINTURE COUVERCLE", qte:2, dim: dim(W + eP*2, pA, tEp)},
      ];

      return {panneaux, patins, renforts, renfortsTitre:"Ceintures"};
    }

    // M70.xlsx (pas de ceintures dans l’Excel)
    // 24 COUVERCLE: D = L+2eP ; F = W+2eP
    function calcM70(L,W,H,eP,eFond,eCouv,tEp,tLarg,pA,pB){
      const faces_L = L + eP*2;
      const faces_H = H;

      const fond_L = L + eP*2;
      const fond_W = W + eP*2;

      const panneaux = [
        {nom:"FACES", qte:2, dim: dim(faces_L, faces_H, eP)},
        {nom:"COTES", qte:2, dim: dim(W, H, eP)},
        {nom:"FOND", qte:1, dim: dim(fond_L, fond_W, eFond)},
        {nom:"COUVERCLE", qte:1, dim: dim(L + eP*2, W + eP*2, eCouv)},
      ];

      const patinLen = W + eP*2;
      const patins = patinsRegle(L, patinLen, null, pA, pB);

      return {panneaux, patins, renforts:[], renfortsTitre:""};
    }

    function calculer(){
      clearMsg();

      const ref = selRef.textContent || "";
      const L = n("L"), W = n("W"), H = n("H");
      if(!ref){ showError("Choisis un modèle."); return; }
      if(!L || !W || !H){ showError("Merci de remplir L, W et H."); return; }

      const eP = n("eP") || 15;
      const eFond = n("eFond") || 15;
      const eCouv = n("eCouv") || 15;
      const tEp = n("tEp") || 18;
      const tLarg = n("tLarg") || 100;

      let pA = n("pA");
      let pB = n("pB");

      // Défauts patins pour M60/M70 comme tes Excel (70 x 18) si l'utilisateur n'a rien changé
      if((ref === "M60" || ref === "M70") && (!pA || !pB)){
        if(!pA) pA = 70;
        if(!pB) pB = 18;
      }
      if(!pA) pA = 95;
      if(!pB) pB = 95;

      let result = null;
      if(ref === "M10") result = calcM10(L,W,H,eP,eFond,eCouv,tEp,tLarg,pA,pB);
      else if(ref === "M20") result = calcM20(L,W,H,eP,eFond,eCouv,tEp,tLarg,pA,pB);
      else if(ref === "M30") result = calcM30(L,W,H,eP,eFond,eCouv,tEp,tLarg,pA,pB);
      else if(ref === "M40") result = calcM40(L,W,H,eP,eFond,eCouv,tEp,tLarg,pA,pB);
      else if(ref === "M50") result = calcM50(L,W,H,eP,eFond,eCouv,tEp,tLarg,pA,pB);
      else if(ref === "M60") result = calcM60(L,W,H,eP,eFond,eCouv,tEp,tLarg,pA,pB);
      else if(ref === "M70") result = calcM70(L,W,H,eP,eFond,eCouv,tEp,tLarg,pA,pB);
      else {
        showError("Calcul non disponible pour ce modèle.");
        return;
      }

      lastResult = {ref,L,W,H, ...result};

      const parts = [];
      parts.push(`<div class="hint" style="margin-top:10px;"><b>${ref}</b> — Dimensions intérieures : ${L} x ${W} x ${H} mm</div>`);
      parts.push(tableHTML("Panneaux", result.panneaux));
      parts.push(tableHTML("Patins", result.patins));
      if(result.renforts && result.renforts.length){
        parts.push(tableHTML(result.renfortsTitre || "Renforts", result.renforts));
      }
      outBox.innerHTML = parts.join("");
    }

    // ====== PDF (images non étirées) ======
    function fetchAsDataURL(url){
      return fetch(url, {cache:"no-store"})
        .then(r => { if(!r.ok) throw new Error("HTTP " + r.status); return r.blob(); })
        .then(blob => new Promise((res, rej) => {
          const reader = new FileReader();
          reader.onload = () => res(reader.result);
          reader.onerror = rej;
          reader.readAsDataURL(blob);
        }));
    }

    function getImageSize(dataUrl){
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.onload = () => resolve({ w: img.naturalWidth, h: img.naturalHeight });
        img.onerror = reject;
        img.src = dataUrl;
      });
    }

    function parseDimsToCols(d){
      const clean = String(d).replace("mm","").trim();
      const parts = clean.split("x").map(s=>s.trim().split(" ")[0]);
      return parts.slice(0,3);
    }

    async function genererPDF(){
      errBox.textContent = "";
      if(!lastResult){
        showError("Clique d'abord sur 'Calculer' pour générer le PDF.");
        return;
      }

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({orientation:"portrait", unit:"mm", format:"a4"});

      const pageW = doc.internal.pageSize.getWidth();
      const pageH = doc.internal.pageSize.getHeight();

      const margin = 10;
      let y = margin;

      // Logo PDF (optionnel)
      try{
        const logo = await fetchAsDataURL("secm_logo.png");
        doc.addImage(logo, "PNG", margin, y, 35, 14);
      }catch(e){}

      doc.setFont("helvetica", "bold");
      doc.setFontSize(14);
      doc.text(`Fiche de débit - Référence : ${lastResult.ref}`, 50, y+8);

      doc.setFont("helvetica", "normal");
      doc.setFontSize(11);
      doc.text(`Dimensions intérieures : ${lastResult.L} x ${lastResult.W} x ${lastResult.H} mm`, 50, y+15);

      y += 22;

      function addSection(title, rows){
        doc.setFont("helvetica","bold");
        doc.setFontSize(11);
        doc.text(title, margin, y);
        y += 2;

        const body = rows.map(r => {
          const cols = parseDimsToCols(r.dim);
          return [r.nom, String(r.qte), cols[0]||"", cols[1]||"", cols[2]||""];
        });

        doc.autoTable({
          startY: y,
          head: [["Pièce","Qté","L","l","ép"]],
          body,
          styles: { font:"helvetica", fontSize:9, cellPadding:1.6 },
          headStyles: { fontStyle:"bold" },
          margin: { left: margin, right: margin },
          tableWidth: pageW - margin*2
        });

        y = doc.lastAutoTable.finalY + 6;
      }

      addSection("Panneaux", lastResult.panneaux);
      addSection("Patins", lastResult.patins);
      if(lastResult.renforts && lastResult.renforts.length){
        addSection(lastResult.renfortsTitre || "Renforts", lastResult.renforts);
      }

      // Image modèle en bas (ratio conservé + centrée)
      try{
        const imgData = await fetchAsDataURL(`${lastResult.ref}.jpg`);
        const size = await getImageSize(imgData);

        const maxW = pageW - margin*2;
        let maxH = 55;
        let imgY = pageH - margin - maxH;

        if (y + 5 > imgY){
          maxH = Math.max(25, pageH - margin - y - 5);
          imgY = pageH - margin - maxH;
        }

        const ratio = size.w / size.h;
        let drawW = maxW;
        let drawH = drawW / ratio;

        if (drawH > maxH){
          drawH = maxH;
          drawW = drawH * ratio;
        }

        const imgX = (pageW - drawW) / 2;
        doc.addImage(imgData, "JPEG", imgX, imgY, drawW, drawH);
      }catch(e){}

      doc.save(`Fiche_debit_${lastResult.ref}.pdf`);
    }

    // ====== UI RENDER ======
    MODELES.forEach(m => {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `<img src="${m.img}" alt="${m.ref}"><div class="ref">${m.ref}</div>`;
      card.onclick = () => {
        clearMsg();
        selRef.textContent = m.ref;
        selImg.src = m.img;
        panel.style.display = "block";
        lastResult = null;
        window.scrollTo({top: document.body.scrollHeight, behavior:"smooth"});
      };
      grid.appendChild(card);
    });
  </script>
</body>
</html>
